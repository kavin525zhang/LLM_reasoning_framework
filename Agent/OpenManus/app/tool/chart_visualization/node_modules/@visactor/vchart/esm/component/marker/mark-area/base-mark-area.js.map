{"version":3,"sources":["../src/component/marker/mark-area/base-mark-area.ts"],"names":[],"mappings":"AACA,OAAO,EACL,gBAAgB,EAChB,wBAAwB,EACxB,cAAc,EACd,cAAc,EACd,sBAAsB,EACvB,MAAM,UAAU,CAAC;AAIlB,OAAO,EAAE,kBAAkB,EAAE,MAAM,qBAAqB,CAAC;AACzD,OAAO,EAAE,UAAU,EAAE,MAAM,gBAAgB,CAAC;AAC5C,OAAO,EAAE,YAAY,EAAE,MAAM,0BAA0B,CAAC;AAExD,MAAM,OAAgB,YAAa,SAAQ,UAAyB;IAApE;;QAEE,YAAO,GAAG,UAAU,CAAC;QAErB,iBAAY,GAAW,YAAY,CAAC,QAAQ,CAAC;IAyI/C,CAAC;IAjIC,MAAM,CAAC,wBAAwB,CAAC,UAAe;QAC7C,MAAM,EAAE,cAAc,EAAE,eAAe,EAAE,eAAe,EAAE,GAAG,sBAAsB,CAAC,UAAU,CAAC,CAAC;QAEhG,IAAI,UAAU,CAAC,cAAc,KAAK,OAAO,IAAI,cAAc,IAAI,eAAe,IAAI,eAAe,EAAE;YACjG,OAAO,OAAO,CAAC;SAChB;QACD,OAAO,WAAW,CAAC;IACrB,CAAC;IAES,sBAAsB;;QAC9B,MAAM,KAAK,GAAG,MAAA,IAAI,CAAC,KAAK,CAAC,KAAK,mCAAI,EAAE,CAAC;QACrC,MAAM,aAAa,GAAqC;YACtD,MAAM,EAAE,IAAI,CAAC,YAAY;YACzB,WAAW,EAAE,MAAA,IAAI,CAAC,KAAK,CAAC,WAAW,mCAAI,IAAI;YAC3C,KAAK,EAAE,MAAA,IAAI,CAAC,KAAK,CAAC,WAAW,mCAAI,IAAI;YACrC,MAAM,EAAE,MAAA,IAAI,CAAC,KAAK,CAAC,WAAW,mCAAI,IAAI;YACtC,MAAM,EAAE;gBACN;oBACE,CAAC,EAAE,CAAC;oBACJ,CAAC,EAAE,CAAC;iBACL;aACF;YACD,MAAM,EAAE;gBACN,CAAC,EAAE,CAAC;gBACJ,CAAC,EAAE,CAAC;aACL;YACD,WAAW,EAAE,CAAC;YACd,WAAW,EAAE,CAAC;YACd,UAAU,EAAE,CAAC;YACb,QAAQ,EAAE,CAAC;YACX,SAAS,EAAE,cAAc,CACvB,kBAAkB,CAAC,MAAA,IAAI,CAAC,KAAK,CAAC,IAAI,0CAAE,KAAK,CAAC,EAC1C,IAAI,CAAC,WAAW,EAChB,IAAI,CAAC,qBAAqB,CAC3B;YACD,WAAW,EAAE,MAAA,IAAI,CAAC,KAAK,CAAC,IAAI,mCAAI,KAAK;YACrC,KAAK,EAAE,wBAAwB,CAAC,KAAK,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,qBAAqB,CAAC;YACpF,KAAK,EAAE;gBACL,IAAI,EAAE,cAAc,CAAC,MAAA,IAAI,CAAC,KAAK,CAAC,IAAI,0CAAE,KAAK,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,qBAAqB,CAAC;gBAC1F,KAAK,EAAE,cAAc,CAAC,MAAA,IAAI,CAAC,KAAK,CAAC,KAAK,0CAAE,KAAK,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,qBAAqB,CAAC;gBAC5F,eAAe,EAAE,cAAc,CAC7B,MAAA,MAAA,MAAA,IAAI,CAAC,KAAK,0CAAE,KAAK,0CAAE,eAAe,0CAAE,KAAK,EACzC,IAAI,CAAC,WAAW,EAChB,IAAI,CAAC,qBAAqB,CAC3B;aACF;YACD,SAAS,EAAE,MAAA,IAAI,CAAC,KAAK,CAAC,SAAS,mCAAI,KAAK;YACxC,cAAc,EAAE,IAAI,CAAC,KAAK,CAAC,cAAc;YACzC,aAAa,EAAE,IAAI,CAAC,KAAK,CAAC,aAAa;YACvC,eAAe,EAAE,IAAI,CAAC,KAAK,CAAC,eAAe;SAC5C,CAAC;QAEF,MAAM,QAAQ,GAAG,IAAI,CAAC,qBAAqB,CAAC,aAAa,CAAC,CAAC;QAC3D,OAAO,QAA6B,CAAC;IACvC,CAAC;IAES,aAAa;;QACrB,MAAM,IAAI,GAAG,IAAI,CAAC,KAAY,CAAC;QAC/B,MAAM,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC;QAC9B,MAAM,mBAAmB,GAAG,IAAI,CAAC,oBAAoB,CAAC;QACtD,MAAM,iBAAiB,GAAG,IAAI,CAAC,kBAAkB,CAAC;QAClD,MAAM,cAAc,GAAG,IAAI,CAAC,eAAe,CAAC;QAE5C,MAAM,UAAU,GAAG,IAAI,CAAC,kBAAkB,EAAE,CAAC;QAE7C,MAAM,UAAU,GAAG,IAAI,CAAC,oBAAoB,EAAE,CAAC,UAAU,CAAC;QAC1D,MAAM,UAAU,GAAG,IAAI;YACrB,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,UAAU;gBACnD,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,UAAU;gBAC/B,CAAC,CAAC,IAAI,CAAC,UAAU;YACnB,CAAC,CAAC,UAAU,CAAC;QAEf,IAAI,SAAS,CAAC;QACd,IAAI,IAAI,CAAC,IAAI,KAAI,MAAA,IAAI,CAAC,KAAK,0CAAE,OAAO,CAAA,EAAE;YACpC,MAAM,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG,gBAAgB,CAAC;gBAClD,mBAAmB,CAAC,SAAS,EAAE;gBAC/B,iBAAiB,CAAC,SAAS,EAAE;gBAC7B,cAAc,CAAC,SAAS,EAAE;aAC3B,CAAC,CAAC;YACH,SAAS,GAAG;gBACV,CAAC,EAAE,IAAI;gBACP,CAAC,EAAE,IAAI;gBACP,KAAK,EAAE,IAAI,GAAG,IAAI;gBAClB,MAAM,EAAE,IAAI,GAAG,IAAI;aACpB,CAAC;SACH;QAED,IAAI,IAAI,CAAC,gBAAgB,EAAE;YACzB,IAAI,CAAC,gBAAgB,CAAC,aAAa,CAAC,gCAC/B,UAAU,KACb,KAAK,kCACA,MAAA,IAAI,CAAC,gBAAgB,CAAC,SAAS,0CAAE,KAAK,KACzC,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,YAAY;wBACjC,CAAC;4BACE,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,YAAY,CAAC,UAAU,EAAE,UAAU,CAAS;wBAChE,CAAC,CAAC,MAAA,MAAA,IAAI,CAAC,gBAAgB,CAAC,SAAS,0CAAE,KAAK,0CAAE,IAAI,KAElD,SAAS,EACT,EAAE,EAAE,IAAI,CAAC,cAAc,EACvB,EAAE,EAAE,IAAI,CAAC,cAAc,GACjB,CAAC,CAAC;SACX;IACH,CAAC;IAES,aAAa;QACrB,MAAM,IAAI,GAAG,IAAI,CAAC,KAAY,CAAC;QAC/B,MAAM,EACJ,UAAU,EACV,UAAU,EACV,WAAW,EACX,cAAc,EACd,eAAe,EACf,eAAe,EACf,oBAAoB,EACrB,GAAG,sBAAsB,CAAC,IAAI,CAAC,CAAC;QACjC,IACE,CAAC,UAAU;YACX,CAAC,UAAU;YACX,CAAC,WAAW;YACZ,CAAC,cAAc;YACf,CAAC,eAAe;YAChB,CAAC,eAAe;YAChB,CAAC,oBAAoB,EACrB;YACA,OAAO,IAAI,CAAC;SACb;QAED,IAAI,CAAC,mBAAmB,EAAE,CAAC;IAC7B,CAAC;;AA3IM,oBAAO,GAAG,UAAU,CAAC","file":"base-mark-area.js","sourcesContent":["import type { IMarkArea, IMarkAreaSpec } from './interface';\nimport {\n  computeClipRange,\n  transformLabelAttributes,\n  transformState,\n  transformStyle,\n  getMarkAreaProcessInfo\n} from '../utils';\nimport type { MarkArcAreaAttrs, MarkAreaAttrs } from '@visactor/vrender-components';\n// eslint-disable-next-line no-duplicate-imports\nimport type { MarkArea as MarkAreaComponent, MarkArcArea as MarkArcAreaComponent } from '@visactor/vrender-components';\nimport { transformToGraphic } from '../../../util/style';\nimport { BaseMarker } from '../base-marker';\nimport { LayoutZIndex } from '../../../constant/layout';\nimport type { IGroup } from '@visactor/vrender-core';\nexport abstract class BaseMarkArea extends BaseMarker<IMarkAreaSpec> implements IMarkArea {\n  static specKey = 'markArea';\n  specKey = 'markArea';\n\n  layoutZIndex: number = LayoutZIndex.MarkArea;\n\n  // eslint-disable-next-line max-len\n  protected abstract _newMarkAreaComponent(\n    attr: MarkAreaAttrs | MarkArcAreaAttrs\n  ): MarkAreaComponent | MarkArcAreaComponent;\n  protected abstract _computePointsAttr(): any;\n\n  static _getMarkerCoordinateType(markerSpec: any): string {\n    const { doAngleProcess, doRadiusProcess, doRadAngProcess } = getMarkAreaProcessInfo(markerSpec);\n\n    if (markerSpec.coordinateType === 'polar' || doAngleProcess || doRadiusProcess || doRadAngProcess) {\n      return 'polar';\n    }\n    return 'cartesian';\n  }\n\n  protected _createMarkerComponent() {\n    const label = this._spec.label ?? {};\n    const markAreaAttrs: MarkAreaAttrs | MarkArcAreaAttrs = {\n      zIndex: this.layoutZIndex,\n      interactive: this._spec.interactive ?? true,\n      hover: this._spec.interactive ?? true,\n      select: this._spec.interactive ?? true,\n      points: [\n        {\n          x: 0,\n          y: 0\n        }\n      ],\n      center: {\n        x: 0,\n        y: 0\n      },\n      innerRadius: 0,\n      outerRadius: 0,\n      startAngle: 0,\n      endAngle: 0,\n      areaStyle: transformStyle(\n        transformToGraphic(this._spec.area?.style),\n        this._markerData,\n        this._markAttributeContext\n      ),\n      clipInRange: this._spec.clip ?? false,\n      label: transformLabelAttributes(label, this._markerData, this._markAttributeContext),\n      state: {\n        area: transformState(this._spec.area?.state, this._markerData, this._markAttributeContext),\n        label: transformState(this._spec.label?.state, this._markerData, this._markAttributeContext),\n        labelBackground: transformState(\n          this._spec?.label?.labelBackground?.state,\n          this._markerData,\n          this._markAttributeContext\n        )\n      },\n      animation: this._spec.animation ?? false,\n      animationEnter: this._spec.animationEnter,\n      animationExit: this._spec.animationExit,\n      animationUpdate: this._spec.animationUpdate\n    };\n\n    const markArea = this._newMarkAreaComponent(markAreaAttrs);\n    return markArea as unknown as IGroup;\n  }\n\n  protected _markerLayout() {\n    const spec = this._spec as any;\n    const data = this._markerData;\n    const startRelativeSeries = this._startRelativeSeries;\n    const endRelativeSeries = this._endRelativeSeries;\n    const relativeSeries = this._relativeSeries;\n\n    const pointsAttr = this._computePointsAttr();\n\n    const seriesData = this._getRelativeDataView().latestData;\n    const dataPoints = data\n      ? data.latestData[0] && data.latestData[0].latestData\n        ? data.latestData[0].latestData\n        : data.latestData\n      : seriesData;\n\n    let limitRect;\n    if (spec.clip || spec.label?.confine) {\n      const { minX, maxX, minY, maxY } = computeClipRange([\n        startRelativeSeries.getRegion(),\n        endRelativeSeries.getRegion(),\n        relativeSeries.getRegion()\n      ]);\n      limitRect = {\n        x: minX,\n        y: minY,\n        width: maxX - minX,\n        height: maxY - minY\n      };\n    }\n\n    if (this._markerComponent) {\n      this._markerComponent.setAttributes({\n        ...pointsAttr,\n        label: {\n          ...this._markerComponent.attribute?.label,\n          text: this._spec.label.formatMethod\n            ? // type error here will be fixed in components\n              (this._spec.label.formatMethod(dataPoints, seriesData) as any)\n            : this._markerComponent.attribute?.label?.text\n        },\n        limitRect,\n        dx: this._layoutOffsetX,\n        dy: this._layoutOffsetY\n      } as any);\n    }\n  }\n\n  protected _initDataView(): void {\n    const spec = this._spec as any;\n    const {\n      doXProcess,\n      doYProcess,\n      doXYProcess,\n      doAngleProcess,\n      doRadiusProcess,\n      doRadAngProcess,\n      doCoordinatesProcess\n    } = getMarkAreaProcessInfo(spec);\n    if (\n      !doXProcess &&\n      !doYProcess &&\n      !doXYProcess &&\n      !doAngleProcess &&\n      !doRadiusProcess &&\n      !doRadAngProcess &&\n      !doCoordinatesProcess\n    ) {\n      return null;\n    }\n\n    this._initCommonDataView();\n  }\n}\n"]}