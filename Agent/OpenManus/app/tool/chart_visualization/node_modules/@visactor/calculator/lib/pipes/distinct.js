"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.distinct = void 0;
const select_1 = require("./select");
const distinct = ({ select }) => {
    if (!select.distinct)
        return (tableData) => tableData;
    return (tableData) => {
        const columns = select.columns.map(select_1.getSelectColumnName);
        const distinctRows = [];
        const distinctMap = new Map();
        tableData.forEach(row => {
            let currentMap = distinctMap;
            columns.forEach((column, index) => {
                const value = row[column];
                if (index === columns.length - 1) {
                    if (!currentMap.has(value)) {
                        currentMap.set(value, new Set());
                    }
                    const values = currentMap.get(value);
                    if (!values.has(value)) {
                        values.add(value);
                        distinctRows.push(row);
                    }
                }
                else {
                    if (!currentMap.has(value)) {
                        currentMap.set(value, new Map());
                    }
                    currentMap = currentMap.get(value);
                }
            });
        });
        return distinctRows;
    };
};
exports.distinct = distinct;
