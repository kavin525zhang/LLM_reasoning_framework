{"version":3,"sources":["../src/marker/common-line.ts"],"names":[],"mappings":"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","file":"common-line.js","sourcesContent":["import type { IGroup, INode } from '@visactor/vrender-core';\nimport { merge } from '@visactor/vutils';\nimport type { ArcSegment, Segment } from '../segment';\nimport type { TagAttributes } from '../tag';\n// eslint-disable-next-line no-duplicate-imports\nimport { Tag } from '../tag';\nimport type { MarkCommonLineAnimationType, MarkCommonLineAttrs, MarkerAnimationState } from './type';\nimport { limitShapeInBounds } from '../util/limit-shape';\nimport { DEFAULT_STATES } from '../constant';\nimport { Marker } from './base';\nimport { DefaultExitMarkerAnimation, DefaultUpdateMarkLineAnimation } from './animate/animate';\n\nexport abstract class MarkCommonLine<LineAttr, LabelPosition> extends Marker<\n  MarkCommonLineAttrs<LineAttr, LabelPosition, MarkCommonLineAnimationType>,\n  MarkCommonLineAnimationType\n> {\n  name = 'markCommonLine';\n\n  /** animate */\n  static _animate?: (line: Segment | ArcSegment, label: Tag, animationConfig: any, state: MarkerAnimationState) => void;\n  defaultUpdateAnimation = DefaultUpdateMarkLineAnimation;\n  defaultExitAnimation = DefaultExitMarkerAnimation;\n\n  protected _line!: Segment | ArcSegment;\n  protected abstract createSegment(): any;\n  protected abstract setLineAttributes(): any;\n  protected abstract getPointAttrByPosition(position: any): any;\n  protected abstract getRotateByAngle(angle: number): number;\n  protected abstract getTextStyle(position: any, labelAngle: number, autoRotate: boolean): any;\n  protected abstract markerAnimate(state: MarkerAnimationState): void;\n\n  getLine() {\n    return this._line;\n  }\n  getLabel() {\n    return this._label;\n  }\n\n  protected setLabelPos(): void {\n    const { label = {}, limitRect } = this.attribute;\n    const { position, confine, autoRotate } = label;\n    const labelPoint = this.getPointAttrByPosition(position);\n    const labelAngle = position.toString().toLocaleLowerCase().includes('start')\n      ? this._line.getStartAngle() || 0\n      : this._line.getEndAngle() || 0;\n    this._label.setAttributes({\n      ...labelPoint.position,\n      angle: autoRotate ? this.getRotateByAngle(labelPoint.angle) : 0,\n      textStyle: {\n        ...this.getTextStyle(position, labelAngle, autoRotate),\n        ...label.textStyle\n      }\n    });\n    if (limitRect && confine) {\n      const { x, y, width, height } = limitRect;\n      limitShapeInBounds(this._label, {\n        x1: x,\n        y1: y,\n        x2: x + width,\n        y2: y + height\n      });\n    }\n  }\n\n  protected initMarker(container: IGroup) {\n    const { label, state } = this.attribute as MarkCommonLineAttrs<\n      LineAttr,\n      LabelPosition,\n      MarkCommonLineAnimationType\n    >;\n    const line = this.createSegment();\n    line.name = 'mark-common-line-line';\n    this._line = line;\n    container.add(line as unknown as INode);\n\n    const markLabel = new Tag({\n      ...(label as TagAttributes),\n      state: {\n        panel: merge({}, DEFAULT_STATES, state?.labelBackground),\n        text: merge({}, DEFAULT_STATES, state?.label)\n      }\n    });\n    markLabel.name = 'mark-common-line-label';\n    this._label = markLabel;\n    container.add(markLabel as unknown as INode);\n    this.setLabelPos();\n  }\n\n  protected updateMarker() {\n    const { label, state } = this.attribute as MarkCommonLineAttrs<\n      LineAttr,\n      LabelPosition,\n      MarkCommonLineAnimationType\n    >;\n\n    this.setLineAttributes();\n\n    if (this._label) {\n      this._label.setAttributes({\n        dx: 0,\n        dy: 0, // 需要进行复位\n        ...(label as TagAttributes),\n        state: {\n          panel: merge({}, DEFAULT_STATES, state?.labelBackground),\n          text: merge({}, DEFAULT_STATES, state?.label)\n        }\n      });\n      this.setLabelPos();\n    }\n  }\n}\n"]}