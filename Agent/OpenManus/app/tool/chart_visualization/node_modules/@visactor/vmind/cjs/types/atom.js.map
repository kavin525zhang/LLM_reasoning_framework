{"version":3,"sources":["../src/types/atom.ts"],"names":[],"mappings":";;;AAOA,IAAY,QAcX;AAdD,WAAY,QAAQ;IAClB,yBAAa,CAAA;IACb,wCAA4B,CAAA;IAC5B,oCAAwB,CAAA;IACxB,qDAAyC,CAAA;IACzC,oCAAwB,CAAA;IACxB,0CAA8B,CAAA;IAC9B,2DAA+C,CAAA;IAC/C,4CAAgC,CAAA;IAChC,wCAA4B,CAAA;IAC5B,wCAA4B,CAAA;IAC5B,qDAAyC,CAAA;IACzC,2CAA+B,CAAA;IAC/B,uCAA2B,CAAA;AAC7B,CAAC,EAdW,QAAQ,GAAR,gBAAQ,KAAR,gBAAQ,QAcnB","file":"atom.js","sourcesContent":["/** Atom Function Types */\n\nimport type { Cell, ChartType } from './chart';\nimport type { VizSchema } from '../atom/type';\nimport type { FieldInfo, DataTable } from './base';\nimport type { Insight } from '../atom/dataInsight/type';\n\nexport enum AtomName {\n  BASE = 'base',\n  DATA_EXTRACT = 'dataExtract',\n  DATA_CLEAN = 'dataClean',\n  MULTIPLE_DATA_CLEAN = 'multipleDataClean',\n  DATA_QUERY = 'dataQuery',\n  CHART_COMMAND = 'chartCommand',\n  MULTIPLE_CHART_COMMAND = 'multipleChartCommand',\n  CHART_GENERATE = 'chartGenerate',\n  DATA_INSIGHT = 'dataInsight',\n  SPEC_INSIGHT = 'specInsight',\n  CHART_QA_EXTRACTION = 'chartQAExtraction',\n  CUSTOM_PROMPT = 'custom_prompt',\n  VCHART_SPEC = 'vchart_spec'\n}\n\nexport interface Usage {\n  prompt_tokens: number;\n  completion_tokens: number;\n  total_tokens: number;\n}\n/** Base LLM Context */\nexport interface BaseContext {\n  /** response logId in chat */\n  logId?: string;\n  /** response id in chat */\n  id?: string;\n  /** user query */\n  query?: string;\n  /** llm response content */\n  response?: string;\n  /** error info */\n  error?: string;\n  /** prompt usage */\n  usage?: Usage;\n  /** LLM thoughts */\n  thoughts?: string;\n  /** function call res */\n  toolRes?: any;\n}\n\nexport interface ClusterDataView {\n  /** cluster result */\n  dataTable: DataTable;\n  /** cluster field */\n  fieldInfo: FieldInfo[];\n  /** valid count of measure fields */\n  validColumnLength: number;\n  /** table row length */\n  validRowLength: number;\n  /** valid cell count */\n  validCellCount: number;\n  /** valid measure cell count */\n  validMeasureCellCount: number;\n}\n\n/** Multiple Dataset */\nexport interface DatasetFromText {\n  /** text object of data extraction */\n  text?: string;\n  /** summary of dataset */\n  summary: string;\n  /** data table of dataset */\n  dataTable: DataTable;\n  /** field info of dataset */\n  fieldInfo: FieldInfo[];\n  /** data position in text */\n  textRange?: [string, string];\n}\n\n/** Context of Data Extraction Atom */\nexport interface DataExtractionCtx extends BaseContext {\n  /** text object of data extraction */\n  text: string;\n  /** extra fieldsInfo of dataTable */\n  fieldInfo?: FieldInfo[];\n  /** Data Table values */\n  dataTable?: DataTable;\n  /** multiple results */\n  datasets?: DatasetFromText[];\n}\n\n/** Context of Chart Command Atom */\nexport interface ChartCommandCtx extends BaseContext {\n  /** text object of data extraction */\n  text: string;\n  /** summary of data table */\n  summary?: string;\n  /** extra fieldsInfo of dataTable */\n  fieldInfo?: FieldInfo[];\n  /** Data Table values */\n  dataTable?: DataTable;\n  /** command */\n  command: string;\n}\n\nexport interface DataCleanCtx extends BaseContext {\n  /** extra fieldsInfo of dataTable */\n  fieldInfo?: FieldInfo[];\n  /** Data Table values */\n  dataTable?: DataTable;\n  /** clutser result */\n  clusterResult?: ClusterDataView[];\n  /** original data table */\n  originalDataTable?: DataTable;\n}\n\nexport interface MultipleDataCleanCtx extends BaseContext {\n  /** multiple dataset */\n  datasets: DatasetFromText[];\n}\n\nexport interface MultipleChartCommandsCtx extends BaseContext {\n  /** multiple dataset */\n  datasets: DatasetFromText[];\n  /** commands */\n  commands: string[];\n}\n\n/** Context of Data Query Atom */\nexport interface DataQueryCtx extends BaseContext {\n  /** current summary of dataTable */\n  dataTableSummary?: string;\n  /** extra fieldsInfo of dataTable */\n  fieldInfo?: FieldInfo[];\n  /** fieldsInfo of sql query result */\n  llmFieldInfo?: FieldInfo[];\n  /** Data Table values */\n  dataTable: DataTable;\n  /** user's command */\n  command: string;\n  /** sql */\n  sql?: string;\n}\n\n/** Context of Chart Generator Atom */\nexport interface ChartGeneratorCtx extends BaseContext {\n  /** extra fieldsInfo of dataTable */\n  fieldInfo?: FieldInfo[];\n  /** Data Table values */\n  dataTable: DataTable;\n  /** command */\n  command: string;\n  /** chart type generator result */\n  chartType?: ChartType;\n  /** field mapping result */\n  cell: Cell;\n  /** vizSchema */\n  vizSchema: VizSchema;\n  /** chart spec */\n  spec: any;\n  /** chart advistor result */\n  chartAdvistorRes?: {\n    chartType: ChartType;\n    spec: any;\n    score: number;\n  }[];\n  /** animation config */\n  time?: { totalTime: number; frameArr: any[] };\n}\n\nexport interface DataInsightCtx extends BaseContext {\n  /** spec of chart */\n  spec?: any;\n  /** data tabel */\n  dataTable?: DataTable;\n  /** fieldsInfo of dataTable */\n  fieldInfo?: FieldInfo[];\n  /** final insight */\n  insights: Insight[];\n  /** chartType of vchart */\n  vChartType?: string;\n  /** chartType */\n  chartType?: ChartType;\n}\n\nexport interface SpecInsightCtx extends BaseContext {\n  /** spec of chart */\n  spec?: any;\n  /** final insight */\n  insights: Insight[];\n  /** chartType */\n  chartType?: ChartType;\n  /** spec added with insights */\n  newSpec?: any;\n}\n\nexport interface ChartQAExtractionCtx extends BaseContext {\n  text: string;\n  question: string;\n  answer: string;\n  keyList: string[];\n  explanation: string;\n}\n\n/**\n * 更新vchart spec 的原子操作\n */\nexport interface IVChartOperationItem {\n  /**\n   * The type of operation to perform.\n   * - \"add\": Add a new field or array element.\n   * - \"update\": Update an existing field or array element.\n   * - \"delete\": Remove an existing field or array element.\n   */\n  op: 'add' | 'update' | 'delete' | 'deleteAll';\n  /**\n   * The target location of the operation in the DSL.\n   * - Use dot notation for nested fields (e.g., \"settings.theme.color\").\n   * - Use square brackets for array indices (e.g., \"data[2]\").\n   */\n  target: string;\n  /**\n   * The value to be added or updated\n   */\n  value?: any;\n}\n\nexport interface VChartSpecCtx extends BaseContext {\n  /**\n   * the original spec\n   */\n  originalSpec: any;\n  /**\n   * the latest spec\n   */\n  spec?: any;\n  /**\n   * the spec before operations\n   */\n  prevSpec?: any;\n  /**\n   * The operations to be performed on the spec\n   */\n  operations?: IVChartOperationItem[];\n  /**\n   * the result of operations\n   */\n  opertationsResult?: number[];\n}\n\nexport interface DialogueChartCtx extends BaseContext {\n  spec: any;\n  oneSpec: any;\n}\n"]}